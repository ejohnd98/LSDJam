[gd_scene load_steps=23 format=3 uid="uid://cb8ennhmak0c6"]

[ext_resource type="Script" path="res://scenes/player/Player.gd" id="1_v6pu0"]
[ext_resource type="Script" path="res://addons/shaker/shaker.gd" id="2_cwelt"]
[ext_resource type="Script" path="res://scenes/player/CameraFollow.gd" id="2_qtkgy"]
[ext_resource type="AudioStream" uid="uid://bmr1qg0f2mye1" path="res://scenes/player/footstep_sounds.tres" id="2_scigr"]
[ext_resource type="Script" path="res://scenes/items/EquippedItem.gd" id="4_7qnge"]
[ext_resource type="Texture2D" uid="uid://y5mapwqofa5p" path="res://textures/flashlight_light.png" id="4_i63nf"]
[ext_resource type="PackedScene" uid="uid://flsh1apt2wu1" path="res://sourceModels/flashlight.glb" id="6_7k7a5"]
[ext_resource type="AudioStream" uid="uid://b2vjuc8llm1d0" path="res://sounds/generic/generic_interact.ogg" id="6_q2scr"]
[ext_resource type="Texture2D" uid="uid://xkkg42yas0uq" path="res://textures/billboard_items/bike_equipped.png" id="6_ujy4m"]
[ext_resource type="AudioStream" uid="uid://lbltaycxtj0w" path="res://sounds/bike_bell.ogg" id="7_fxm4y"]
[ext_resource type="AudioStream" uid="uid://dqc85l4su56s4" path="res://sounds/bike_loop.ogg" id="8_kkpb4"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_2l4ng"]
custom_solver_bias = 1.0
radius = 0.25
height = 1.25

[sub_resource type="CapsuleMesh" id="CapsuleMesh_ckb3d"]
radius = 0.25
height = 1.25

[sub_resource type="Animation" id="Animation_7udfn"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, 1.4, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../HeldItemPivot:position")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, 1.385, 0)]
}

[sub_resource type="Animation" id="Animation_5o4s3"]
resource_name = "bob"
length = 1.2
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.3, 0.6, 0.9, 1.2),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0, 1.4, 0), Vector3(0, 1.44, 0), Vector3(0, 1.4, 0), Vector3(0, 1.44, 0), Vector3(0, 1.4, 0)]
}
tracks/1/type = "method"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("..")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.3, 0.9),
"transitions": PackedFloat32Array(1, 1),
"values": [{
"args": [],
"method": &"on_footstep"
}, {
"args": [],
"method": &"on_footstep"
}]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../HeldItemPivot:position")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 0.3, 0.6, 0.9, 1.2),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0, 1.385, 0), Vector3(0.008, 1.405, 0), Vector3(0, 1.385, 0), Vector3(-0.008, 1.405, 0), Vector3(0, 1.385, 0)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_682er"]
_data = {
"RESET": SubResource("Animation_7udfn"),
"bob": SubResource("Animation_5o4s3")
}

[sub_resource type="Curve" id="Curve_4c5fq"]
_data = [Vector2(0, 1), 0.0, -4.58824, 0, 0, Vector2(0.549632, 0), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="GDScript" id="GDScript_7oyox"]
script/source = "extends SpotLight3D

func adjust_brightness():
	if GameManager.get_dream_grid().name == \"Dark Forest\":
		light_energy = 7.0
	else:
		light_energy = 1.7
"

[sub_resource type="CylinderMesh" id="CylinderMesh_evhs4"]
top_radius = 0.045
bottom_radius = 0.045
height = 0.6

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_wbwct"]
albedo_color = Color(1, 0, 0, 1)

[sub_resource type="QuadMesh" id="QuadMesh_vtxrh"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_6n4ow"]
transparency = 2
alpha_scissor_threshold = 0.5
alpha_antialiasing_mode = 0
albedo_texture = ExtResource("6_ujy4m")

[node name="Player" type="RigidBody3D" groups=["player"]]
axis_lock_angular_x = true
axis_lock_angular_z = true
mass = 20.0
gravity_scale = 0.0
can_sleep = false
lock_rotation = true
custom_integrator = true
continuous_cd = true
script = ExtResource("1_v6pu0")
ground_collision_mask = 2

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
process_mode = 3
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.1, 0)
shape = SubResource("CapsuleShape3D_2l4ng")

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.1, 0)
visible = false
mesh = SubResource("CapsuleMesh_ckb3d")

[node name="CameraPivot" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.4, 0)

[node name="AnimationPlayer" type="AnimationPlayer" parent="CameraPivot"]
libraries = {
"": SubResource("AnimationLibrary_682er")
}

[node name="CameraParent" type="Node3D" parent="CameraPivot"]

[node name="CameraDetachedParent" type="Node3D" parent="CameraPivot/CameraParent"]
script = ExtResource("2_qtkgy")

[node name="Camera3D" type="Camera3D" parent="CameraPivot/CameraParent/CameraDetachedParent"]

[node name="Shaker" type="Node" parent="CameraPivot/CameraParent/CameraDetachedParent/Camera3D" node_paths=PackedStringArray("target_node")]
script = ExtResource("2_cwelt")
target_node = NodePath("..")
target_property = &"position"
min_value = -0.2
max_value = 0.2
duration = 2.0
fall_off = SubResource("Curve_4c5fq")

[node name="HeldItemPivot" type="Node3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.385, 0)

[node name="HeldItem" type="Node3D" parent="HeldItemPivot"]
transform = Transform3D(0.999639, 0, 0.0268748, 0.00159151, 0.998245, -0.0591979, -0.0268277, 0.0592193, 0.997884, 0.360696, -0.290567, -0.416431)

[node name="HeldItemDetachedParent" type="Node3D" parent="HeldItemPivot/HeldItem"]
script = ExtResource("2_qtkgy")

[node name="Flashlight" type="Node3D" parent="HeldItemPivot/HeldItem/HeldItemDetachedParent"]
transform = Transform3D(1, 1.16415e-10, 0, 0, 1, -3.72529e-09, 0, 0, 1, 0, 0, 0)
visible = false
script = ExtResource("4_7qnge")
item_name = "flashlight"

[node name="SpotLight3D" type="SpotLight3D" parent="HeldItemPivot/HeldItem/HeldItemDetachedParent/Flashlight"]
process_mode = 3
transform = Transform3D(1, 8.14907e-10, 5.02914e-08, 0, 1, 1.86265e-08, 0, 0, 1, 0, -1.19209e-07, -0.206933)
light_energy = 7.0
light_indirect_energy = 0.0
light_volumetric_fog_energy = 0.0
light_projector = ExtResource("4_i63nf")
light_bake_mode = 0
shadow_enabled = true
spot_range = 24.0
spot_angle = 60.0
script = SubResource("GDScript_7oyox")

[node name="flashlight" parent="HeldItemPivot/HeldItem/HeldItemDetachedParent/Flashlight" instance=ExtResource("6_7k7a5")]
transform = Transform3D(0.456921, 2.32831e-10, -9.31323e-10, 0, 0.456921, 7.45058e-09, -9.31323e-10, -7.45058e-09, 0.456921, -5.96046e-08, 0, 0.0628149)

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="HeldItemPivot/HeldItem/HeldItemDetachedParent/Flashlight"]
stream = ExtResource("6_q2scr")
volume_db = -5.0
bus = &"SFX"

[node name="Gun" type="Node3D" parent="HeldItemPivot/HeldItem/HeldItemDetachedParent"]
transform = Transform3D(1, 1.16415e-10, 0, 0, 1, -3.72529e-09, 0, 0, 1, 0, 0, 0)
visible = false
script = ExtResource("4_7qnge")
item_name = "gun"

[node name="GunModel" type="MeshInstance3D" parent="HeldItemPivot/HeldItem/HeldItemDetachedParent/Gun"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 0, 0)
mesh = SubResource("CylinderMesh_evhs4")
surface_material_override/0 = SubResource("StandardMaterial3D_wbwct")

[node name="Bike" type="Node3D" parent="HeldItemPivot/HeldItem/HeldItemDetachedParent"]
transform = Transform3D(1, 1.16415e-10, 0, 0, 1, -3.72529e-09, 0, 0, 1, 0, 0, 0)
visible = false
script = ExtResource("4_7qnge")
item_name = "bike"

[node name="BikeSprite" type="MeshInstance3D" parent="HeldItemPivot/HeldItem/HeldItemDetachedParent/Bike"]
transform = Transform3D(0.431305, -1.16415e-10, -9.31323e-10, -1.16415e-10, 0.197764, 0.11163, -5.58794e-09, -0.0529908, 0.416609, -0.357063, 0.251951, 0.248742)
mesh = SubResource("QuadMesh_vtxrh")
surface_material_override/0 = SubResource("StandardMaterial3D_6n4ow")

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="HeldItemPivot/HeldItem/HeldItemDetachedParent/Bike"]
stream = ExtResource("7_fxm4y")
volume_db = -5.0

[node name="LoopingAudio" type="AudioStreamPlayer" parent="HeldItemPivot/HeldItem/HeldItemDetachedParent/Bike"]
stream = ExtResource("8_kkpb4")
bus = &"SFX"

[node name="JumpTimer" type="Timer" parent="."]
wait_time = 0.2
one_shot = true

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="."]
stream = ExtResource("2_scigr")
volume_db = -35.0
pitch_scale = 0.85
bus = &"SFX"

[node name="SoundCooldown" type="Timer" parent="AudioStreamPlayer"]
wait_time = 0.15
one_shot = true

[node name="CycleItemTimer" type="Timer" parent="."]
wait_time = 0.1
one_shot = true
